# Create the .env file
read -p "Please enter a password for the 'admin' user: " -s ADMIN_PASSWORD_PLAIN; echo
echo "FLASK_SECRET_KEY=$(python3 -c 'import secrets; print(secrets.token_hex(16))')" > .env
echo "ADMIN_USERNAME=admin" >> .env; echo "ADMIN_PASSWORD=$ADMIN_PASSWORD_PLAIN" >> .env
echo "API_KEY=$(python3 -c 'import secrets; print(secrets.token_hex(32))')" >> .env
echo "POSTGRES_USER=corpus_user" >> .env; echo "POSTGRES_PASSWORD=$(python3 -c 'import secrets; print(secrets.token_hex(16))')" >> .env
echo "POSTGRES_DB=corpus_db" >> .env

# Create the model
python3 -m venv venv; source venv/bin/activate; pip3 install scikit-learn==1.5.0 > /dev/null
python3 -c "import pickle; from sklearn.feature_extraction.text import TfidfVectorizer, LogisticRegression, Pipeline; model = Pipeline([('vectorizer', TfidfVectorizer()), ('classifier', LogisticRegression())]); model.fit(['contract text', 'invoice text'], ['Contract', 'Finance']); pickle.dump(model, open('server/model.pkl', 'wb'))"
deactivate; rm -rf venv